{"ast":null,"code":"import _toConsumableArray from\"/Users/alinaturbina/Uni Projects/seba/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/alinaturbina/Uni Projects/seba/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/alinaturbina/Uni Projects/seba/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/alinaturbina/Uni Projects/seba/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from'react';import'antd/dist/antd.css';import{Upload,Modal}from'antd';import{PlusOutlined}from'@ant-design/icons';import{sha256}from'js-sha256';import{useDispatch}from'react-redux';import{usePet,usePetPictures}from'helper/hooks/pets.hooks';import{useUser}from'helper/hooks/auth.hooks';import{updatePicturesToUpload}from'redux/actions';import{UPLOAD_STATUS}from'helper/types';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var prepareFileList=function prepareFileList(petPictures){var petList=[];petPictures.forEach(function(value,index){petList.push({uid:index,name:value.title,status:UPLOAD_STATUS.DONE,url:value.src});});return petList;};var MultiplePhotosUpload=function MultiplePhotosUpload(props){var dispatch=useDispatch();var mode=props.mode;var pet=usePet();var user=useUser();var petPictures=usePetPictures();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),previewVisible=_useState2[0],setPreviewVisible=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),previewImage=_useState4[0],setPreviewImage=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),previewTitle=_useState6[0],setPreviewTitle=_useState6[1];var _useState7=useState(mode==='add'?[]:prepareFileList(petPictures)),_useState8=_slicedToArray(_useState7,2),fileList=_useState8[0],setFileList=_useState8[1];// get base64 format of the uploaded picture\nvar getBase64=function getBase64(photo){return new Promise(function(resolve,reject){var reader=new FileReader();reader.readAsDataURL(photo);reader.onload=function(){return resolve(reader.result);};reader.onerror=function(error){return reject(error);};});};var handleCancel=function handleCancel(){return setPreviewVisible(false);};// update file list\nvar handleChange=function handleChange(_ref){var fileList=_ref.fileList;return setFileList(fileList);};var handlePreview=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(photo){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(!photo.url&&!photo.preview)){_context.next=4;break;}_context.next=3;return getBase64(photo.originFileObj);case 3:photo.preview=_context.sent;case 4:// if photo is uploaded, show modal, set preview image and preview title\nsetPreviewImage(photo.url||photo.preview);setPreviewVisible(true);setPreviewTitle(photo.name||photo.url.substring(photo.url.lastIndexOf('/')+1));case 7:case\"end\":return _context.stop();}}},_callee);}));return function handlePreview(_x){return _ref2.apply(this,arguments);};}();// upload image to the firebase\nvar customUpload=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(data){var imageName,imgPath,newData,pics;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:imageName=sha256(data.file.name);//a unique name for the image\n/** Firebase structure\n         * -| users\n         *   -| userId\n         *     -| pets\n         *      -| images\n         */imgPath=\"users/\".concat(user.id,\"/pets/images/\").concat(imageName);// set status upload to upload it later to firebase\nnewData={title:data.file.name,path:imgPath,src:undefined,description:'',status:UPLOAD_STATUS.UPLOAD,data:data};pics=[].concat(_toConsumableArray(petPictures),[newData]);// set global state\ndispatch(updatePicturesToUpload(pics));data.onSuccess(null);case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function customUpload(_x2){return _ref3.apply(this,arguments);};}();// remove the image from firebase\nvar handleRemove=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(file){var picTemp,pics;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:picTemp=_toConsumableArray(petPictures);if(file.url){// set status delete to remove it later onSave from firebase\npicTemp.map(function(value){return value.title===file.name?value.status=UPLOAD_STATUS.DELETE:value;});dispatch(updatePicturesToUpload(picTemp));}else{pics=picTemp.filter(function(value){return value.title!==file.name;});dispatch(updatePicturesToUpload(pics));}case 2:case\"end\":return _context3.stop();}}},_callee3);}));return function handleRemove(_x3){return _ref4.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Upload,{listType:\"picture-card\",fileList:fileList,onPreview:handlePreview,onChange:handleChange,customRequest:customUpload,onRemove:handleRemove,children:fileList.length>=8?null:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(PlusOutlined,{}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:8},children:\"Upload\"})]})}),/*#__PURE__*/_jsx(Modal,{visible:previewVisible,title:previewTitle,footer:null,onCancel:handleCancel,children:/*#__PURE__*/_jsx(\"img\",{alt:\"preview\",style:{width:'100%'},src:previewImage})})]});};export default MultiplePhotosUpload;","map":{"version":3,"sources":["/Users/alinaturbina/Uni Projects/seba/frontend/src/components/upload/multiple-photos.upload.js"],"names":["React","useState","Upload","Modal","PlusOutlined","sha256","useDispatch","usePet","usePetPictures","useUser","updatePicturesToUpload","UPLOAD_STATUS","prepareFileList","petPictures","petList","forEach","value","index","push","uid","name","title","status","DONE","url","src","MultiplePhotosUpload","props","dispatch","mode","pet","user","previewVisible","setPreviewVisible","previewImage","setPreviewImage","previewTitle","setPreviewTitle","fileList","setFileList","getBase64","photo","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","result","onerror","error","handleCancel","handleChange","handlePreview","preview","originFileObj","substring","lastIndexOf","customUpload","data","imageName","file","imgPath","id","newData","path","undefined","description","UPLOAD","pics","onSuccess","handleRemove","picTemp","map","DELETE","filter","length","marginTop","width"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport 'antd/dist/antd.css';\nimport { Upload, Modal } from 'antd';\nimport { PlusOutlined } from '@ant-design/icons';\nimport { sha256 } from 'js-sha256';\nimport { useDispatch } from 'react-redux';\nimport { usePet, usePetPictures } from 'helper/hooks/pets.hooks';\nimport { useUser } from 'helper/hooks/auth.hooks';\nimport { updatePicturesToUpload } from 'redux/actions';\nimport { UPLOAD_STATUS } from 'helper/types';\n\nconst prepareFileList = (petPictures) => {\n    let petList = [];\n    petPictures.forEach((value, index) => {\n        petList.push({\n            uid: index,\n            name: value.title,\n            status: UPLOAD_STATUS.DONE,\n            url: value.src,\n        });\n    });\n    return petList;\n};\n\nconst MultiplePhotosUpload = (props) => {\n    const dispatch = useDispatch();\n    const { mode } = props;\n    const pet = usePet();\n    const user = useUser();\n    const petPictures = usePetPictures();\n\n    const [previewVisible, setPreviewVisible] = useState(false);\n    const [previewImage, setPreviewImage] = useState('');\n    const [previewTitle, setPreviewTitle] = useState('');\n    const [fileList, setFileList] = useState(mode === 'add' ? [] : prepareFileList(petPictures));\n\n    // get base64 format of the uploaded picture\n    const getBase64 = (photo) => {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.readAsDataURL(photo);\n            reader.onload = () => resolve(reader.result);\n            reader.onerror = (error) => reject(error);\n        });\n    };\n\n    const handleCancel = () => setPreviewVisible(false);\n\n    // update file list\n    const handleChange = ({ fileList }) => setFileList(fileList);\n\n    const handlePreview = async (photo) => {\n        if (!photo.url && !photo.preview) {\n            photo.preview = await getBase64(photo.originFileObj);\n        }\n        // if photo is uploaded, show modal, set preview image and preview title\n        setPreviewImage(photo.url || photo.preview);\n        setPreviewVisible(true);\n        setPreviewTitle(photo.name || photo.url.substring(photo.url.lastIndexOf('/') + 1));\n    };\n\n    // upload image to the firebase\n    const customUpload = async (data) => {\n        const imageName = sha256(data.file.name); //a unique name for the image\n\n        /** Firebase structure\n         * -| users\n         *   -| userId\n         *     -| pets\n         *      -| images\n         */\n\n        const imgPath = `users/${user.id}/pets/images/${imageName}`;\n\n        // set status upload to upload it later to firebase\n        const newData = {\n            title: data.file.name,\n            path: imgPath,\n            src: undefined,\n            description: '',\n            status: UPLOAD_STATUS.UPLOAD,\n            data: data,\n        };\n\n        let pics = [...petPictures, newData];\n\n        // set global state\n        dispatch(updatePicturesToUpload(pics));\n\n        data.onSuccess(null);\n    };\n\n    // remove the image from firebase\n    const handleRemove = async (file) => {\n        let picTemp = [...petPictures];\n        if (file.url) {\n            // set status delete to remove it later onSave from firebase\n            picTemp.map((value) => (value.title === file.name ? (value.status = UPLOAD_STATUS.DELETE) : value));\n            dispatch(updatePicturesToUpload(picTemp));\n        } else {\n            let pics = picTemp.filter((value) => value.title !== file.name);\n            dispatch(updatePicturesToUpload(pics));\n        }\n    };\n\n    return (\n        <div>\n            <Upload listType=\"picture-card\" fileList={fileList} onPreview={handlePreview} onChange={handleChange} customRequest={customUpload} onRemove={handleRemove}>\n                {fileList.length >= 8 ? null : (\n                    <div>\n                        <PlusOutlined />\n                        <div style={{ marginTop: 8 }}>Upload</div>\n                    </div>\n                )}\n            </Upload>\n            <Modal visible={previewVisible} title={previewTitle} footer={null} onCancel={handleCancel}>\n                <img alt=\"preview\" style={{ width: '100%' }} src={previewImage} />\n            </Modal>\n        </div>\n    );\n};\n\nexport default MultiplePhotosUpload;\n"]},"metadata":{},"sourceType":"module"}