{"ast":null,"code":"var _jsxFileName = \"/Users/alinaturbina/Uni Projects/seba/frontend/src/views/AddPetView.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport { connect, useDispatch } from 'react-redux';\nimport { useHistory } from 'react-router-dom';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { Button, CircularProgress } from '@material-ui/core'; // components imports\n\nimport { PetInformationForm, PetPhotosForm } from 'components/forms';\nimport Loading from 'components/Loading';\nimport { useLoggedInUser } from 'helper/hooks/auth.hooks'; // store-relevant imports\n\nimport { usePetCompetitions, usePetDocuments, usePetPictures, usePetProfilePictureToUpload, useUser } from 'helper/hooks/';\nimport { addPet, clearPet, updateCompetitionsToUpload, updateDocumentsToUpload, updatePicturesToUpload, updateProfilePicture, getUserPets } from 'redux/actions'; // services import\n\nimport { FirebaseService, NotificationService } from 'services';\nimport { isObjEmpty } from 'helper/helpers';\n/**\n * \n * @param {*} props \n * Main view for adding a new pet\n */\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst AddPetView = props => {\n  _s();\n\n  const classes = useStyles();\n  const dispatch = useDispatch();\n  const history = useHistory(); // get user\n\n  const user = useUser();\n  const loggedInUser = useLoggedInUser(); // get pet upload states\n\n  const petDocuments = usePetDocuments();\n  const petCompetitions = usePetCompetitions();\n  const petPictures = usePetPictures();\n  const petProfilePictureToUpload = usePetProfilePictureToUpload();\n  const [loading, setLoading] = useState(true);\n  const [buttonLoading, setButtonLoading] = useState(false);\n  const [formIsDisabled, setFormIsDisabled] = useState(false);\n  const [name, setName] = useState('');\n  const [nickname, setNickname] = useState('');\n  const [sex, setSex] = useState('');\n  const [birthDate, setBirthDate] = useState(new Date());\n  const [species, setSpecies] = useState('');\n  const [breed, setBreed] = useState('');\n  const [price, setPrice] = useState(0);\n  const [purchased, setPurchased] = useState(false);\n  useEffect(() => {\n    const isEmpty = obj => obj === '' || obj === undefined;\n\n    const disabled = isEmpty(name) || isObjEmpty(petProfilePictureToUpload) || isEmpty(sex) || isEmpty(species) || isEmpty(breed);\n    setFormIsDisabled(disabled);\n  }, [name, sex, breed, species, petProfilePictureToUpload]);\n  useEffect(() => {\n    let loading = true;\n\n    const clear = async () => {\n      if (!loading) return;\n      dispatch(clearPet());\n      setLoading(false);\n    };\n\n    clear();\n    return () => {\n      loading = false;\n    };\n  }, [dispatch]);\n\n  const uploadCompetitions = async () => {\n    const competitionsData = [...petCompetitions];\n\n    for (let index = 0; index < competitionsData.length; index++) {\n      let value = competitionsData[index];\n\n      if (value.certificate !== null || value.certificate !== undefined) {\n        const metadata = {\n          contentType: value.certificate.type\n        };\n        let url = await FirebaseService.upload(value.certificate.path, value.certificate.data, metadata);\n        competitionsData[index].certificate.url = url;\n      }\n    }\n\n    await dispatch(updateCompetitionsToUpload(competitionsData));\n    return competitionsData;\n  };\n\n  const uploadDocuments = async () => {\n    const documentsData = [...petDocuments];\n\n    for (let index = 0; index < documentsData.length; index++) {\n      let value = documentsData[index];\n      const metadata = {\n        contentType: value.type\n      };\n      let url = await FirebaseService.upload(value.path, value.data, metadata);\n      documentsData[index].url = url;\n    }\n\n    await dispatch(updateDocumentsToUpload(documentsData));\n    return documentsData;\n  };\n\n  const uploadPictures = async () => {\n    const picturesData = [...petPictures];\n\n    for (let index = 0; index < picturesData.length; index++) {\n      let value = picturesData[index];\n      const metadata = {\n        contentType: 'image/png'\n      };\n      let url = await FirebaseService.upload(value.path, value.data, metadata);\n      picturesData[index].src = url;\n    }\n\n    await dispatch(updatePicturesToUpload(picturesData));\n    return picturesData;\n  };\n\n  const uploadProfilePicture = async () => {\n    let value = petProfilePictureToUpload;\n    const metadata = {\n      contentType: 'image/png'\n    };\n    let url = await FirebaseService.upload(value.path, value.data, metadata);\n    value.src = url;\n    await dispatch(updateProfilePicture(value, {}));\n    return value;\n  };\n\n  const createPet = async () => {\n    setButtonLoading(true); // upload documents and pics to firebase first\n\n    const documents = await uploadDocuments();\n    const competitions = await uploadCompetitions();\n    const pictures = await uploadPictures();\n    const profilePicture = await uploadProfilePicture();\n    const dateCreated = Date.now(); // combine all information about a pet\n\n    let petToUpload = {\n      ownerId: user.id,\n      officialName: name,\n      nickname: nickname,\n      birthDate: birthDate,\n      sex: sex,\n      price: price,\n      profilePicture: profilePicture,\n      pictures: pictures,\n      dateCreated: dateCreated,\n      breed: breed,\n      species: species,\n      competitions: competitions,\n      documents: documents\n    };\n\n    const onSuccess = () => {\n      NotificationService.notify('success', 'Success', 'Your four-legged friend was added to your profile!');\n      history.push('/');\n      dispatch(clearPet()); // update pets of logged in user in redux store\n\n      dispatch(getUserPets(user.id));\n    };\n\n    const onError = () => {\n      NotificationService.notify('error', 'Error', 'There was a problem uploading your pet.');\n    };\n\n    await dispatch(addPet(petToUpload, onSuccess, onError));\n    setButtonLoading(false);\n  };\n\n  return loading ? /*#__PURE__*/_jsxDEV(Loading, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 180,\n    columnNumber: 9\n  }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: classes.layout,\n      children: [/*#__PURE__*/_jsxDEV(PetPhotosForm, {\n        mode: \"add\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(PetInformationForm, {\n        mode: \"add\",\n        nameProp: {\n          name,\n          setName\n        },\n        nicknameProp: {\n          nickname,\n          setNickname\n        },\n        sexProp: {\n          sex,\n          setSex\n        },\n        birthDateProp: {\n          birthDate,\n          setBirthDate\n        },\n        speciesProp: {\n          species,\n          setSpecies\n        },\n        breedProp: {\n          breed,\n          setBreed\n        },\n        priceProp: {\n          price,\n          setPrice\n        },\n        disabledProp: {\n          formIsDisabled,\n          setFormIsDisabled\n        },\n        purchasedProp: {\n          purchased,\n          setPurchased\n        },\n        user: loggedInUser\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: classes.button,\n      children: /*#__PURE__*/_jsxDEV(Button, {\n        disabled: formIsDisabled,\n        onClick: createPet,\n        type: \"submit\",\n        variant: \"contained\",\n        color: \"secondary\",\n        size: \"large\",\n        children: [buttonLoading ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n          size: 20,\n          style: {\n            marginRight: 10,\n            color: 'white'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 38\n        }, this) : '', \" Save\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 182,\n    columnNumber: 9\n  }, this);\n};\n\n_s(AddPetView, \"+Wcu9VHZvkIrrx78SOVcGOp7a20=\", false, function () {\n  return [useStyles, useDispatch, useHistory, useUser, useLoggedInUser, usePetDocuments, usePetCompetitions, usePetPictures, usePetProfilePictureToUpload];\n});\n\n_c = AddPetView;\nconst useStyles = makeStyles(theme => ({\n  layout: {\n    display: 'flex',\n    width: '100%',\n    justifyContent: 'center',\n    [theme.breakpoints.down('sm')]: {\n      flexDirection: 'column',\n      width: 'auto',\n      alignItems: 'center'\n    }\n  },\n  button: {\n    display: 'flex',\n    justifyContent: 'flex-end',\n    marginRight: 50,\n    marginBottom: 25,\n    marginTop: -25\n  }\n})); // connect() establishes the connection to the redux functionalities\n\nexport default connect()(AddPetView);\n\nvar _c;\n\n$RefreshReg$(_c, \"AddPetView\");","map":{"version":3,"sources":["/Users/alinaturbina/Uni Projects/seba/frontend/src/views/AddPetView.js"],"names":["React","useEffect","useState","connect","useDispatch","useHistory","makeStyles","Button","CircularProgress","PetInformationForm","PetPhotosForm","Loading","useLoggedInUser","usePetCompetitions","usePetDocuments","usePetPictures","usePetProfilePictureToUpload","useUser","addPet","clearPet","updateCompetitionsToUpload","updateDocumentsToUpload","updatePicturesToUpload","updateProfilePicture","getUserPets","FirebaseService","NotificationService","isObjEmpty","AddPetView","props","classes","useStyles","dispatch","history","user","loggedInUser","petDocuments","petCompetitions","petPictures","petProfilePictureToUpload","loading","setLoading","buttonLoading","setButtonLoading","formIsDisabled","setFormIsDisabled","name","setName","nickname","setNickname","sex","setSex","birthDate","setBirthDate","Date","species","setSpecies","breed","setBreed","price","setPrice","purchased","setPurchased","isEmpty","obj","undefined","disabled","clear","uploadCompetitions","competitionsData","index","length","value","certificate","metadata","contentType","type","url","upload","path","data","uploadDocuments","documentsData","uploadPictures","picturesData","src","uploadProfilePicture","createPet","documents","competitions","pictures","profilePicture","dateCreated","now","petToUpload","ownerId","id","officialName","onSuccess","notify","push","onError","layout","button","marginRight","color","theme","display","width","justifyContent","breakpoints","down","flexDirection","alignItems","marginBottom","marginTop"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { connect, useDispatch } from 'react-redux';\nimport { useHistory } from 'react-router-dom';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { Button, CircularProgress } from '@material-ui/core';\n// components imports\nimport { PetInformationForm, PetPhotosForm } from 'components/forms';\nimport Loading from 'components/Loading';\nimport { useLoggedInUser } from 'helper/hooks/auth.hooks';\n\n// store-relevant imports\nimport { usePetCompetitions, usePetDocuments, usePetPictures, usePetProfilePictureToUpload, useUser } from 'helper/hooks/';\nimport { addPet, clearPet, updateCompetitionsToUpload, updateDocumentsToUpload, updatePicturesToUpload, updateProfilePicture, getUserPets } from 'redux/actions';\n// services import\nimport { FirebaseService, NotificationService } from 'services';\nimport { isObjEmpty } from 'helper/helpers';\n\n/**\n * \n * @param {*} props \n * Main view for adding a new pet\n */\nconst AddPetView = (props) => {\n    const classes = useStyles();\n    const dispatch = useDispatch();\n    const history = useHistory();\n\n    // get user\n    const user = useUser();\n    const loggedInUser = useLoggedInUser();\n\n    // get pet upload states\n    const petDocuments = usePetDocuments();\n    const petCompetitions = usePetCompetitions();\n    const petPictures = usePetPictures();\n    const petProfilePictureToUpload = usePetProfilePictureToUpload();\n\n    const [loading, setLoading] = useState(true);\n    const [buttonLoading, setButtonLoading] = useState(false);\n    const [formIsDisabled, setFormIsDisabled] = useState(false);\n    const [name, setName] = useState('');\n    const [nickname, setNickname] = useState('');\n    const [sex, setSex] = useState('');\n    const [birthDate, setBirthDate] = useState(new Date());\n    const [species, setSpecies] = useState('');\n    const [breed, setBreed] = useState('');\n    const [price, setPrice] = useState(0);\n    const [purchased, setPurchased] = useState(false);\n\n    useEffect(() => {\n        const isEmpty = (obj) => obj === '' || obj === undefined;\n        const disabled = isEmpty(name) || isObjEmpty(petProfilePictureToUpload) || isEmpty(sex) || isEmpty(species) || isEmpty(breed);\n        setFormIsDisabled(disabled);\n    }, [name, sex, breed, species, petProfilePictureToUpload]);\n\n    useEffect(() => {\n        let loading = true;\n\n        const clear = async () => {\n            if (!loading) return;\n            dispatch(clearPet());\n            setLoading(false);\n        };\n\n        clear();\n\n        return () => {\n            loading = false;\n        };\n    }, [dispatch]);\n\n    const uploadCompetitions = async () => {\n        const competitionsData = [...petCompetitions];\n        for (let index = 0; index < competitionsData.length; index++) {\n            let value = competitionsData[index];\n            if (value.certificate !== null || value.certificate !== undefined) {\n                const metadata = {\n                    contentType: value.certificate.type,\n                };\n                let url = await FirebaseService.upload(value.certificate.path, value.certificate.data, metadata);\n                competitionsData[index].certificate.url = url;\n            }\n        }\n\n        await dispatch(updateCompetitionsToUpload(competitionsData));\n\n        return competitionsData;\n    };\n\n    const uploadDocuments = async () => {\n        const documentsData = [...petDocuments];\n        for (let index = 0; index < documentsData.length; index++) {\n            let value = documentsData[index];\n            const metadata = {\n                contentType: value.type,\n            };\n            let url = await FirebaseService.upload(value.path, value.data, metadata);\n            documentsData[index].url = url;\n        }\n\n        await dispatch(updateDocumentsToUpload(documentsData));\n\n        return documentsData;\n    };\n\n    const uploadPictures = async () => {\n        const picturesData = [...petPictures];\n        for (let index = 0; index < picturesData.length; index++) {\n            let value = picturesData[index];\n            const metadata = {\n                contentType: 'image/png',\n            };\n\n            let url = await FirebaseService.upload(value.path, value.data, metadata);\n            picturesData[index].src = url;\n        }\n\n        await dispatch(updatePicturesToUpload(picturesData));\n\n        return picturesData;\n    };\n\n    const uploadProfilePicture = async () => {\n        let value = petProfilePictureToUpload;\n        const metadata = {\n            contentType: 'image/png',\n        };\n\n        let url = await FirebaseService.upload(value.path, value.data, metadata);\n        value.src = url;\n\n        await dispatch(updateProfilePicture(value, {}));\n        return value;\n    };\n\n    const createPet = async () => {\n        setButtonLoading(true);\n\n        // upload documents and pics to firebase first\n        const documents = await uploadDocuments();\n        const competitions = await uploadCompetitions();\n        const pictures = await uploadPictures();\n        const profilePicture = await uploadProfilePicture();\n\n        const dateCreated = Date.now();\n        // combine all information about a pet\n        let petToUpload = {\n            ownerId: user.id,\n            officialName: name,\n            nickname: nickname,\n            birthDate: birthDate,\n            sex: sex,\n            price: price,\n            profilePicture: profilePicture,\n            pictures: pictures,\n            dateCreated: dateCreated,\n            breed: breed,\n            species: species,\n            competitions: competitions,\n            documents: documents,\n        };\n\n        const onSuccess = () => {\n            NotificationService.notify('success', 'Success', 'Your four-legged friend was added to your profile!');\n            history.push('/');\n            dispatch(clearPet());\n            // update pets of logged in user in redux store\n            dispatch(getUserPets(user.id));\n        };\n\n        const onError = () => {\n            NotificationService.notify('error', 'Error', 'There was a problem uploading your pet.');\n        };\n\n        await dispatch(addPet(petToUpload, onSuccess, onError));\n        setButtonLoading(false);\n    };\n\n    return loading ? (\n        <Loading />\n    ) : (\n        <div>\n            <div className={classes.layout}>\n                <PetPhotosForm mode=\"add\" />\n                <PetInformationForm\n                    mode=\"add\"\n                    nameProp={{ name, setName }}\n                    nicknameProp={{ nickname, setNickname }}\n                    sexProp={{ sex, setSex }}\n                    birthDateProp={{ birthDate, setBirthDate }}\n                    speciesProp={{ species, setSpecies }}\n                    breedProp={{ breed, setBreed }}\n                    priceProp={{ price, setPrice }}\n                    disabledProp={{ formIsDisabled, setFormIsDisabled }}\n                    purchasedProp={{ purchased, setPurchased }}\n                    user={loggedInUser}\n                />\n            </div>\n            <div className={classes.button}>\n                <Button disabled={formIsDisabled} onClick={createPet} type=\"submit\" variant=\"contained\" color=\"secondary\" size=\"large\">\n                    {buttonLoading ? <CircularProgress size={20} style={{ marginRight: 10, color: 'white' }} /> : ''} Save\n                </Button>\n            </div>\n        </div>\n    );\n};\n\nconst useStyles = makeStyles((theme) => ({\n    layout: {\n        display: 'flex',\n        width: '100%',\n        justifyContent: 'center',\n        [theme.breakpoints.down('sm')]: {\n            flexDirection: 'column',\n            width: 'auto',\n            alignItems: 'center',\n        },\n    },\n    button: {\n        display: 'flex',\n        justifyContent: 'flex-end',\n        marginRight: 50,\n        marginBottom: 25,\n        marginTop: -25,\n    },\n}));\n\n// connect() establishes the connection to the redux functionalities\nexport default connect()(AddPetView);\n"]},"metadata":{},"sourceType":"module"}