{"ast":null,"code":"import _regeneratorRuntime from\"/Users/alinaturbina/Uni Projects/seba/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/alinaturbina/Uni Projects/seba/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/alinaturbina/Uni Projects/seba/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';// antd imports\nimport{Table,Tag,Tooltip,Modal}from'antd';import'../../theming/antd.css';// material-ui imports\nimport{makeStyles}from'@material-ui/core/styles';import{useDispatch}from'react-redux';import PetPreviewProfileComponent from'components/pet-profile/PetPreviewProfileComponent';import StatusTag from'components/tags/StatusTag';import{useUser}from'helper/hooks/auth.hooks';import PriceTag from'components/PriceTag';import{getTransactions,updateTransaction}from'redux/actions';import moment from'moment';import{Button,Typography}from'@material-ui/core';import AddBoxIcon from'@material-ui/icons/AddBox';import{NotificationService}from'services';import{addReview}from'redux/actions';import AddReviewComponent from'components/user-profile/AddReview';import{Chip}from'@material-ui/core';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var TransactionsOverviewTable=function TransactionsOverviewTable(props){var classes=useStyles();var dispatch=useDispatch();var transactions=props.transactions;// states\nvar user=useUser();var checkRequiresInvestigation=function checkRequiresInvestigation(t){return t.senderResponse==='fail'&&t.receiverResponse==='success'||t.senderResponse==='success'&&t.receiverResponse==='fail';};var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isModalVisible=_React$useState2[0],setIsModalVisible=_React$useState2[1];var _React$useState3=React.useState(0),_React$useState4=_slicedToArray(_React$useState3,2),rating=_React$useState4[0],setRating=_React$useState4[1];var _React$useState5=React.useState(''),_React$useState6=_slicedToArray(_React$useState5,2),review=_React$useState6[0],setReview=_React$useState6[1];var _React$useState7=React.useState(''),_React$useState8=_slicedToArray(_React$useState7,2),transactionId=_React$useState8[0],setTransactionId=_React$useState8[1];var _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),name=_React$useState10[0],setName=_React$useState10[1];var _React$useState11=React.useState(''),_React$useState12=_slicedToArray(_React$useState11,2),revieweeId=_React$useState12[0],setRevieweeId=_React$useState12[1];var showModal=function showModal(record){console.log(record);setTransactionId(record.orderNr);var petOwner=getPetOwner(record);setName(petOwner.username);setRevieweeId(petOwner._id);setIsModalVisible(true);};var hideModal=function hideModal(){setIsModalVisible(false);};var saveReview=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var onSuccess,onError,reviewToUpload;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:onSuccess=function onSuccess(){NotificationService.notify('success','Success','Your review was successfully added!');setIsModalVisible(false);};onError=function onError(){NotificationService.notify('error','Error','There was a problem adding your review.');setIsModalVisible(false);};reviewToUpload={reviewerId:user.id,revieweeId:revieweeId,review:review,rating:rating,transactionNr:transactionId};dispatch(addReview(reviewToUpload,onSuccess,onError));case 4:case\"end\":return _context.stop();}}},_callee);}));return function saveReview(){return _ref.apply(this,arguments);};}();// check if user is the sender or the receiver\nvar checkUserIsSender=function checkUserIsSender(transaction){var _transaction$receiver,_transaction$senderId;if(((_transaction$receiver=transaction.receiverId)===null||_transaction$receiver===void 0?void 0:_transaction$receiver._id)===user.id){return false;}else if(((_transaction$senderId=transaction.senderId)===null||_transaction$senderId===void 0?void 0:_transaction$senderId._id)===user.id){return true;}};// update transaction on confirming to change the transaction status\nvar confirm=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(transaction){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return dispatch(updateTransaction(transaction));case 2:_context2.next=4;return dispatch(getTransactions(user.id));case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function confirm(_x){return _ref2.apply(this,arguments);};}();var checkUserStatusWasSet=function checkUserStatusWasSet(transaction){var isSender=checkUserIsSender(transaction);var senderResponse=transaction.senderResponse,receiverResponse=transaction.receiverResponse,status=transaction.status;var statusWasSet=status==='fail'||status==='success';if(isSender)return senderResponse==='success'||senderResponse==='fail'||statusWasSet;else return receiverResponse==='success'||receiverResponse==='fail'||statusWasSet;};// get the owner of the pet\nvar getPetOwner=function getPetOwner(transaction){var _transaction$pet,_transaction$senderId2;if(((_transaction$pet=transaction.pet)===null||_transaction$pet===void 0?void 0:_transaction$pet.ownerId)===((_transaction$senderId2=transaction.senderId)===null||_transaction$senderId2===void 0?void 0:_transaction$senderId2._id)){return transaction.senderId;}else{return transaction.receiverId;}};// show tooltip on hovering over pending status row\nvar getToolTipTitle=function getToolTipTitle(transaction,type){var status=transaction.status,senderResponse=transaction.senderResponse,receiverResponse=transaction.receiverResponse,fee=transaction.fee;if(type==='amount'){if(fee>0&&!checkUserIsSender(transaction)){return'Because of your free plan, we charge 5% (min 1€ and max 20€) from the transaction price.';}}else{if(status==='pending'){if(senderResponse==='pending'&&receiverResponse==='pending'){return'Both receiver and sender have not responded yet.';}else if(senderResponse==='pending'){return'Sender have not responded yet.';}else if(receiverResponse==='pending'){return'Receiver have not responded yet.';}}else if(status==='fail'&&(senderResponse==='fail'&&receiverResponse==='success'||senderResponse==='success'&&receiverResponse==='fail')){return'Transaction requires further investigation. Our employee will contact you soon.';}else return null;}};var columns=[{title:'ID',dataIndex:'orderNr',key:'orderNr',render:function render(id){return/*#__PURE__*/_jsx(Typography,{children:String(id).toUpperCase()});}},{title:'MATE',dataIndex:'pet',key:'pet',align:'center',render:function render(_,record){return/*#__PURE__*/_jsx(PetPreviewProfileComponent,{username:getPetOwner(record).username,pet:record.pet});}},{title:'AMOUNT',dataIndex:'amount',key:'amount',align:'right',render:function render(_,record){return/*#__PURE__*/_jsx(Tooltip,{trigger:\"hover\",placement:\"top\",title:getToolTipTitle(record,'amount'),children:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(PriceTag,{isSender:checkUserIsSender(record),price:record.amount,fee:record.fee})})});}},{title:'DEADLINE',dataIndex:'deadline',key:'deadline',align:'center',render:function render(deadline){return/*#__PURE__*/_jsx(Typography,{children:String(moment(deadline).format('LLL'))});}},{title:'YOUR RESPONSE',key:'response',dataIndex:'response',render:function render(_,record){return/*#__PURE__*/_jsx(StatusTag,{status:checkUserIsSender(record)?record.senderResponse:record.receiverResponse,isSelected:checkUserStatusWasSet(record),confirm:confirm,transaction:record,isSender:checkUserIsSender(record)});}},{title:'STATUS',key:'status',dataIndex:'status',align:'center',render:function render(_,record){return/*#__PURE__*/_jsxs(Tooltip,{trigger:\"hover\",placement:\"top\",title:getToolTipTitle(record,'status'),children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(StatusTag,{status:record.status,isSelected:true})}),checkRequiresInvestigation(record)?/*#__PURE__*/_jsx(Chip,{className:classes.tags,variant:\"outlined\",label:\"Requires Investigation\",style:{color:'black',background:'#FCCA46',borderColor:'#FDCD7F',borderWidth:2,fontWeight:'lighter'}}):null]});}},{title:'REVIEW',dataIndex:'review',key:'review',align:'center',render:function render(_,record){return/*#__PURE__*/_jsxs(Button,{disabled:!checkUserIsSender(record)||!record.isReviewed,children:[\" \",/*#__PURE__*/_jsx(AddBoxIcon,{onClick:function onClick(){if(checkUserIsSender(record)||!record.isReviewed){showModal(record);}}}),\" \"]});}}];return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Table,{columns:columns,dataSource:transactions}),/*#__PURE__*/_jsx(Modal,{visible:isModalVisible,onOk:saveReview,onCancel:hideModal,className:classes.modal,children:/*#__PURE__*/_jsx(AddReviewComponent,{ratingProp:{rating:rating,setRating:setRating},reviewProp:{review:review,setReview:setReview},name:name})})]});};var useStyles=makeStyles(function(theme){return{layout:{display:'flex',flexDirection:'row',justifyContent:'center',alignItems:'center'},label:{fontSize:16,fontWeight:500},grid:{display:'flex',justifyContent:'flex-end',alignSelf:'flex-end'},tags:{marginTop:10},modal:{width:'80vw',margin:'0 auto',marginTop:100}};});export default TransactionsOverviewTable;","map":{"version":3,"sources":["/Users/alinaturbina/Uni Projects/seba/frontend/src/components/transactions/TransactionsOverviewTable.js"],"names":["React","Table","Tag","Tooltip","Modal","makeStyles","useDispatch","PetPreviewProfileComponent","StatusTag","useUser","PriceTag","getTransactions","updateTransaction","moment","Button","Typography","AddBoxIcon","NotificationService","addReview","AddReviewComponent","Chip","TransactionsOverviewTable","props","classes","useStyles","dispatch","transactions","user","checkRequiresInvestigation","t","senderResponse","receiverResponse","useState","isModalVisible","setIsModalVisible","rating","setRating","review","setReview","transactionId","setTransactionId","name","setName","revieweeId","setRevieweeId","showModal","record","console","log","orderNr","petOwner","getPetOwner","username","_id","hideModal","saveReview","onSuccess","notify","onError","reviewToUpload","reviewerId","id","transactionNr","checkUserIsSender","transaction","receiverId","senderId","confirm","checkUserStatusWasSet","isSender","status","statusWasSet","pet","ownerId","getToolTipTitle","type","fee","columns","title","dataIndex","key","render","String","toUpperCase","align","_","amount","deadline","format","tags","color","background","borderColor","borderWidth","fontWeight","isReviewed","modal","theme","layout","display","flexDirection","justifyContent","alignItems","label","fontSize","grid","alignSelf","marginTop","width","margin"],"mappings":"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","sourcesContent":["import React from 'react';\n// antd imports\nimport { Table, Tag, Tooltip, Modal } from 'antd';\nimport '../../theming/antd.css';\n// material-ui imports\nimport { makeStyles } from '@material-ui/core/styles';\nimport { useDispatch } from 'react-redux';\nimport PetPreviewProfileComponent from 'components/pet-profile/PetPreviewProfileComponent';\nimport StatusTag from 'components/tags/StatusTag';\nimport { useUser } from 'helper/hooks/auth.hooks';\nimport PriceTag from 'components/PriceTag';\nimport { getTransactions, updateTransaction } from 'redux/actions';\nimport moment from 'moment';\nimport { Button, Typography } from '@material-ui/core';\nimport AddBoxIcon from '@material-ui/icons/AddBox';\nimport { NotificationService } from 'services';\nimport { addReview } from 'redux/actions';\nimport AddReviewComponent from 'components/user-profile/AddReview';\nimport { Chip } from '@material-ui/core';\n\nconst TransactionsOverviewTable = (props) => {\n    const classes = useStyles();\n    const dispatch = useDispatch();\n    const { transactions } = props;\n\n    // states\n    const user = useUser();\n    const checkRequiresInvestigation = (t) => (t.senderResponse === 'fail' && t.receiverResponse === 'success') || (t.senderResponse === 'success' && t.receiverResponse === 'fail');\n    const [isModalVisible, setIsModalVisible] = React.useState(false);\n    const [rating, setRating] = React.useState(0);\n    const [review, setReview] = React.useState('');\n    const [transactionId, setTransactionId] = React.useState('');\n    const [name, setName] = React.useState(false);\n    const [revieweeId, setRevieweeId] = React.useState('');\n\n    const showModal = (record) => {\n        console.log(record);\n        setTransactionId(record.orderNr);\n        let petOwner = getPetOwner(record)\n        setName(petOwner.username);\n        setRevieweeId(petOwner._id)\n        setIsModalVisible(true);\n    };\n\n    const hideModal = () => {\n        setIsModalVisible(false);\n    };\n\n    const saveReview = async () => {\n        const onSuccess = () => {\n            NotificationService.notify('success', 'Success', 'Your review was successfully added!');\n            setIsModalVisible(false);\n        };\n\n        const onError = () => {\n            NotificationService.notify('error', 'Error', 'There was a problem adding your review.');\n            setIsModalVisible(false);\n        };\n\n        let reviewToUpload = {\n            reviewerId: user.id,\n            revieweeId: revieweeId,\n            review: review,\n            rating: rating,\n            transactionNr: transactionId\n        };\n\n        dispatch(addReview(reviewToUpload, onSuccess, onError));\n    };\n\n    // check if user is the sender or the receiver\n    const checkUserIsSender = (transaction) => {\n        if (transaction.receiverId?._id === user.id) {\n            return false;\n        } else if (transaction.senderId?._id === user.id) {\n            return true;\n        }\n    };\n\n    // update transaction on confirming to change the transaction status\n    const confirm = async (transaction) => {\n        await dispatch(updateTransaction(transaction));\n        await dispatch(getTransactions(user.id));\n    };\n\n    const checkUserStatusWasSet = (transaction) => {\n        const isSender = checkUserIsSender(transaction);\n        const { senderResponse, receiverResponse, status } = transaction;\n        const statusWasSet = status === 'fail' || status === 'success';\n        if (isSender) return senderResponse === 'success' || senderResponse === 'fail' || statusWasSet;\n        else return receiverResponse === 'success' || receiverResponse === 'fail' || statusWasSet;\n    };\n\n    // get the owner of the pet\n    const getPetOwner = (transaction) => {\n        if (transaction.pet?.ownerId === transaction.senderId?._id) {\n            return transaction.senderId;\n        } else {\n            return transaction.receiverId;\n        }\n    };\n\n    // show tooltip on hovering over pending status row\n    const getToolTipTitle = (transaction, type) => {\n        const { status, senderResponse, receiverResponse, fee } = transaction;\n\n        if (type === 'amount') {\n            if (fee > 0 && !checkUserIsSender(transaction)) {\n                return 'Because of your free plan, we charge 5% (min 1€ and max 20€) from the transaction price.';\n            }\n        } else {\n            if (status === 'pending') {\n                if (senderResponse === 'pending' && receiverResponse === 'pending') {\n                    return 'Both receiver and sender have not responded yet.';\n                } else if (senderResponse === 'pending') {\n                    return 'Sender have not responded yet.';\n                } else if (receiverResponse === 'pending') {\n                    return 'Receiver have not responded yet.';\n                }\n            } else if (status === 'fail' && ((senderResponse === 'fail' && receiverResponse === 'success') || (senderResponse === 'success' && receiverResponse === 'fail'))) {\n                return 'Transaction requires further investigation. Our employee will contact you soon.';\n            } else return null;\n        }\n    };\n\n    const columns = [\n        {\n            title: 'ID',\n            dataIndex: 'orderNr',\n            key: 'orderNr',\n            render: (id) => <Typography>{String(id).toUpperCase()}</Typography>,\n        },\n        {\n            title: 'MATE',\n            dataIndex: 'pet',\n            key: 'pet',\n            align: 'center',\n            render: (_, record) => <PetPreviewProfileComponent username={getPetOwner(record).username} pet={record.pet} />,\n        },\n        {\n            title: 'AMOUNT',\n            dataIndex: 'amount',\n            key: 'amount',\n            align: 'right',\n            render: (_, record) => (\n                <Tooltip trigger=\"hover\" placement=\"top\" title={getToolTipTitle(record, 'amount')}>\n                    <div>\n                        <PriceTag isSender={checkUserIsSender(record)} price={record.amount} fee={record.fee} />\n                    </div>\n                </Tooltip>\n            ),\n        },\n        {\n            title: 'DEADLINE',\n            dataIndex: 'deadline',\n            key: 'deadline',\n            align: 'center',\n            render: (deadline) => <Typography>{String(moment(deadline).format('LLL'))}</Typography>,\n        },\n        {\n            title: 'YOUR RESPONSE',\n            key: 'response',\n            dataIndex: 'response',\n            render: (_, record) => (\n                <StatusTag\n                    status={checkUserIsSender(record) ? record.senderResponse : record.receiverResponse}\n                    isSelected={checkUserStatusWasSet(record)}\n                    confirm={confirm}\n                    transaction={record}\n                    isSender={checkUserIsSender(record)}\n                />\n            ),\n        },\n        {\n            title: 'STATUS',\n            key: 'status',\n            dataIndex: 'status',\n            align: 'center',\n            render: (_, record) => (\n                <Tooltip trigger=\"hover\" placement=\"top\" title={getToolTipTitle(record, 'status')}>\n                    <div>\n                        <StatusTag status={record.status} isSelected={true} />\n                    </div>\n                    {checkRequiresInvestigation(record) ? (\n                        <Chip\n                            className={classes.tags}\n                            variant=\"outlined\"\n                            label=\"Requires Investigation\"\n                            style={{ color: 'black', background: '#FCCA46', borderColor: '#FDCD7F', borderWidth: 2, fontWeight: 'lighter' }}\n                        />\n                    ) : null}\n                </Tooltip>\n            ),\n        },\n        {\n            title: 'REVIEW',\n            dataIndex: 'review',\n            key: 'review',\n            align: 'center',\n            render: (_, record) => <Button disabled={!checkUserIsSender(record) || !record.isReviewed}> <AddBoxIcon onClick={function () { if (checkUserIsSender(record) || !record.isReviewed) { showModal(record); } }} /> </Button>,\n        },\n    ];\n\n    return (\n        <div>\n            <Table columns={columns} dataSource={transactions} />\n            <Modal visible={isModalVisible} onOk={saveReview} onCancel={hideModal} className={classes.modal}>\n                <AddReviewComponent ratingProp={{ rating, setRating }} reviewProp={{ review, setReview }} name={name} />\n            </Modal>\n        </div>\n    );\n};\n\nconst useStyles = makeStyles((theme) => ({\n    layout: {\n        display: 'flex',\n        flexDirection: 'row',\n        justifyContent: 'center',\n        alignItems: 'center',\n    },\n    label: {\n        fontSize: 16,\n        fontWeight: 500,\n    },\n    grid: {\n        display: 'flex',\n        justifyContent: 'flex-end',\n        alignSelf: 'flex-end',\n    },\n    tags: {\n        marginTop: 10,\n    },\n    modal: {\n        width: '80vw',\n        margin: '0 auto',\n        marginTop: 100,\n    },\n}));\n\nexport default TransactionsOverviewTable;\n"]},"metadata":{},"sourceType":"module"}