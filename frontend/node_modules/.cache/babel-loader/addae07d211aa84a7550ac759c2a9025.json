{"ast":null,"code":"var _jsxFileName = \"/Users/alinaturbina/Uni Projects/seba/frontend/src/components/upload/multiple-photos.upload.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport 'antd/dist/antd.css';\nimport { Upload, Modal } from 'antd';\nimport { PlusOutlined } from '@ant-design/icons';\nimport { sha256 } from 'js-sha256';\nimport { useDispatch } from 'react-redux';\nimport { usePet, usePetPictures } from 'helper/hooks/pets.hooks';\nimport { useUser } from 'helper/hooks/auth.hooks';\nimport { updatePicturesToUpload } from 'redux/actions';\nimport { UPLOAD_STATUS } from 'helper/types';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst prepareFileList = petPictures => {\n  let petList = [];\n  petPictures.forEach((value, index) => {\n    petList.push({\n      uid: index,\n      name: value.title,\n      status: UPLOAD_STATUS.DONE,\n      url: value.src\n    });\n  });\n  return petList;\n};\n\nconst MultiplePhotosUpload = props => {\n  _s();\n\n  const dispatch = useDispatch();\n  const {\n    mode\n  } = props;\n  const pet = usePet();\n  const user = useUser();\n  const petPictures = usePetPictures();\n  const [previewVisible, setPreviewVisible] = useState(false);\n  const [previewImage, setPreviewImage] = useState('');\n  const [previewTitle, setPreviewTitle] = useState('');\n  const [fileList, setFileList] = useState(mode === 'add' ? [] : prepareFileList(petPictures)); // get base64 format of the uploaded picture\n\n  const getBase64 = photo => {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.readAsDataURL(photo);\n\n      reader.onload = () => resolve(reader.result);\n\n      reader.onerror = error => reject(error);\n    });\n  };\n\n  const handleCancel = () => setPreviewVisible(false); // update file list\n\n\n  const handleChange = ({\n    fileList\n  }) => setFileList(fileList);\n\n  const handlePreview = async photo => {\n    if (!photo.url && !photo.preview) {\n      photo.preview = await getBase64(photo.originFileObj);\n    } // if photo is uploaded, show modal, set preview image and preview title\n\n\n    setPreviewImage(photo.url || photo.preview);\n    setPreviewVisible(true);\n    setPreviewTitle(photo.name || photo.url.substring(photo.url.lastIndexOf('/') + 1));\n  }; // upload image to the firebase\n\n\n  const customUpload = async data => {\n    const imageName = sha256(data.file.name); //a unique name for the image\n\n    /** Firebase structure\n     * -| users\n     *   -| userId\n     *     -| pets\n     *      -| images\n     */\n\n    const imgPath = `users/${user.id}/pets/images/${imageName}`; // set status upload to upload it later to firebase\n\n    const newData = {\n      title: data.file.name,\n      path: imgPath,\n      src: undefined,\n      description: '',\n      status: UPLOAD_STATUS.UPLOAD,\n      data: data\n    };\n    let pics = [...petPictures, newData]; // set global state\n\n    dispatch(updatePicturesToUpload(pics));\n    data.onSuccess(null);\n  }; // remove the image from firebase\n\n\n  const handleRemove = async file => {\n    let picTemp = [...pet.pictures];\n\n    if (file.url) {\n      // set status delete to remove it later onSave from firebase\n      picTemp.map(value => value.title === file.name ? value.status = UPLOAD_STATUS.DELETE : value);\n      dispatch(updatePicturesToUpload(picTemp));\n    } else {\n      let pics = picTemp.filter(value => value.title !== file.name);\n      dispatch(updatePicturesToUpload(pics));\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(Upload, {\n      listType: \"picture-card\",\n      fileList: fileList,\n      onPreview: handlePreview,\n      onChange: handleChange,\n      customRequest: customUpload,\n      onRemove: handleRemove,\n      children: fileList.length >= 8 ? null : /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(PlusOutlined, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            marginTop: 8\n          },\n          children: \"Upload\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Modal, {\n      visible: previewVisible,\n      title: previewTitle,\n      footer: null,\n      onCancel: handleCancel,\n      children: /*#__PURE__*/_jsxDEV(\"img\", {\n        alt: \"preview\",\n        style: {\n          width: '100%'\n        },\n        src: previewImage\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 107,\n    columnNumber: 9\n  }, this);\n};\n\n_s(MultiplePhotosUpload, \"S0NSt49y8NcqFqcQ+l4g7sw0NFs=\", false, function () {\n  return [useDispatch, usePet, useUser, usePetPictures];\n});\n\n_c = MultiplePhotosUpload;\nexport default MultiplePhotosUpload;\n\nvar _c;\n\n$RefreshReg$(_c, \"MultiplePhotosUpload\");","map":{"version":3,"sources":["/Users/alinaturbina/Uni Projects/seba/frontend/src/components/upload/multiple-photos.upload.js"],"names":["React","useState","Upload","Modal","PlusOutlined","sha256","useDispatch","usePet","usePetPictures","useUser","updatePicturesToUpload","UPLOAD_STATUS","prepareFileList","petPictures","petList","forEach","value","index","push","uid","name","title","status","DONE","url","src","MultiplePhotosUpload","props","dispatch","mode","pet","user","previewVisible","setPreviewVisible","previewImage","setPreviewImage","previewTitle","setPreviewTitle","fileList","setFileList","getBase64","photo","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","result","onerror","error","handleCancel","handleChange","handlePreview","preview","originFileObj","substring","lastIndexOf","customUpload","data","imageName","file","imgPath","id","newData","path","undefined","description","UPLOAD","pics","onSuccess","handleRemove","picTemp","pictures","map","DELETE","filter","length","marginTop","width"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport 'antd/dist/antd.css';\nimport { Upload, Modal } from 'antd';\nimport { PlusOutlined } from '@ant-design/icons';\nimport { sha256 } from 'js-sha256';\nimport { useDispatch } from 'react-redux';\nimport { usePet, usePetPictures } from 'helper/hooks/pets.hooks';\nimport { useUser } from 'helper/hooks/auth.hooks';\nimport { updatePicturesToUpload } from 'redux/actions';\nimport { UPLOAD_STATUS } from 'helper/types';\n\nconst prepareFileList = (petPictures) => {\n    let petList = [];\n    petPictures.forEach((value, index) => {\n        petList.push({\n            uid: index,\n            name: value.title,\n            status: UPLOAD_STATUS.DONE,\n            url: value.src,\n        });\n    });\n    return petList;\n};\n\nconst MultiplePhotosUpload = (props) => {\n    const dispatch = useDispatch();\n    const { mode } = props;\n    const pet = usePet();\n    const user = useUser();\n    const petPictures = usePetPictures();\n\n    const [previewVisible, setPreviewVisible] = useState(false);\n    const [previewImage, setPreviewImage] = useState('');\n    const [previewTitle, setPreviewTitle] = useState('');\n    const [fileList, setFileList] = useState(mode === 'add' ? [] : prepareFileList(petPictures));\n\n    // get base64 format of the uploaded picture\n    const getBase64 = (photo) => {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.readAsDataURL(photo);\n            reader.onload = () => resolve(reader.result);\n            reader.onerror = (error) => reject(error);\n        });\n    };\n\n    const handleCancel = () => setPreviewVisible(false);\n\n    // update file list\n    const handleChange = ({ fileList }) => setFileList(fileList);\n\n    const handlePreview = async (photo) => {\n        if (!photo.url && !photo.preview) {\n            photo.preview = await getBase64(photo.originFileObj);\n        }\n        // if photo is uploaded, show modal, set preview image and preview title\n        setPreviewImage(photo.url || photo.preview);\n        setPreviewVisible(true);\n        setPreviewTitle(photo.name || photo.url.substring(photo.url.lastIndexOf('/') + 1));\n    };\n\n    // upload image to the firebase\n    const customUpload = async (data) => {\n        const imageName = sha256(data.file.name); //a unique name for the image\n\n        /** Firebase structure\n         * -| users\n         *   -| userId\n         *     -| pets\n         *      -| images\n         */\n\n        const imgPath = `users/${user.id}/pets/images/${imageName}`;\n\n        // set status upload to upload it later to firebase\n        const newData = {\n            title: data.file.name,\n            path: imgPath,\n            src: undefined,\n            description: '',\n            status: UPLOAD_STATUS.UPLOAD,\n            data: data,\n        };\n\n        let pics = [...petPictures, newData];\n\n        // set global state\n        dispatch(updatePicturesToUpload(pics));\n\n        data.onSuccess(null);\n    };\n\n    // remove the image from firebase\n    const handleRemove = async (file) => {\n        let picTemp = [...pet.pictures];\n        if (file.url) {\n            // set status delete to remove it later onSave from firebase\n            picTemp.map((value) => (value.title === file.name ? (value.status = UPLOAD_STATUS.DELETE) : value));\n            dispatch(updatePicturesToUpload(picTemp));\n        } else {\n            let pics = picTemp.filter((value) => value.title !== file.name);\n            dispatch(updatePicturesToUpload(pics));\n        }\n    };\n\n    return (\n        <div>\n            <Upload listType=\"picture-card\" fileList={fileList} onPreview={handlePreview} onChange={handleChange} customRequest={customUpload} onRemove={handleRemove}>\n                {fileList.length >= 8 ? null : (\n                    <div>\n                        <PlusOutlined />\n                        <div style={{ marginTop: 8 }}>Upload</div>\n                    </div>\n                )}\n            </Upload>\n            <Modal visible={previewVisible} title={previewTitle} footer={null} onCancel={handleCancel}>\n                <img alt=\"preview\" style={{ width: '100%' }} src={previewImage} />\n            </Modal>\n        </div>\n    );\n};\n\nexport default MultiplePhotosUpload;\n"]},"metadata":{},"sourceType":"module"}